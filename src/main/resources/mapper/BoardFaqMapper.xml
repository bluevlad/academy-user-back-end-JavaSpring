<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.academy.mapper.BoardFaqMapper">

    <!-- 게시판 정보 조회 -->
    <select id="getBoardInfo" parameterType="hashmap" resultType="hashmap">
        SELECT
            BOARD_MNG_SEQ,
            BOARD_NM,
            BOARD_DESC,
            USE_YN
        FROM TB_BOARD_MNG
        WHERE BOARD_MNG_SEQ = #{BOARD_MNG_SEQ}
    </select>

    <!-- FAQ 게시판 목록 조회 -->
    <select id="boardFaqList" parameterType="hashmap" resultType="hashmap">
        SELECT
            A.BOARD_SEQ,
            A.BOARD_MNG_SEQ,
            A.SUBJECT,
            A.CONTENT,
            A.REG_ID,
            A.REG_NM,
            DATE_FORMAT(A.REG_DT, '%Y-%m-%d') AS REG_DT,
            A.CATEGORY_CODE,
            (SELECT C.CATEGORY_NM FROM TB_CATEGORY C WHERE C.CATEGORY_CODE = A.CATEGORY_CODE) AS CATEGORY_NM
        FROM TB_BOARD A
        WHERE A.BOARD_MNG_SEQ = #{BOARD_MNG_SEQ}
          AND A.DEL_YN = 'N'
          AND A.OPEN_YN = 'Y'
        <if test="CATEGORY_CODE != null and CATEGORY_CODE != ''">
            AND A.CATEGORY_CODE = #{CATEGORY_CODE}
        </if>
        <if test="SEARCHTEXT != null and SEARCHTEXT != ''">
            <choose>
                <when test="SEARCHKIND == 'subject'">
                    AND A.SUBJECT LIKE CONCAT('%', #{SEARCHTEXT}, '%')
                </when>
                <when test="SEARCHKIND == 'content'">
                    AND A.CONTENT LIKE CONCAT('%', #{SEARCHTEXT}, '%')
                </when>
                <otherwise>
                    AND (A.SUBJECT LIKE CONCAT('%', #{SEARCHTEXT}, '%')
                         OR A.CONTENT LIKE CONCAT('%', #{SEARCHTEXT}, '%'))
                </otherwise>
            </choose>
        </if>
        ORDER BY A.SORT_ORDER ASC, A.REG_DT DESC, A.BOARD_SEQ DESC
        LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
    </select>

    <!-- FAQ 게시판 목록 수 조회 -->
    <select id="boardFaqListCount" parameterType="hashmap" resultType="int">
        SELECT COUNT(*)
        FROM TB_BOARD A
        WHERE A.BOARD_MNG_SEQ = #{BOARD_MNG_SEQ}
          AND A.DEL_YN = 'N'
          AND A.OPEN_YN = 'Y'
        <if test="CATEGORY_CODE != null and CATEGORY_CODE != ''">
            AND A.CATEGORY_CODE = #{CATEGORY_CODE}
        </if>
        <if test="SEARCHTEXT != null and SEARCHTEXT != ''">
            <choose>
                <when test="SEARCHKIND == 'subject'">
                    AND A.SUBJECT LIKE CONCAT('%', #{SEARCHTEXT}, '%')
                </when>
                <when test="SEARCHKIND == 'content'">
                    AND A.CONTENT LIKE CONCAT('%', #{SEARCHTEXT}, '%')
                </when>
                <otherwise>
                    AND (A.SUBJECT LIKE CONCAT('%', #{SEARCHTEXT}, '%')
                         OR A.CONTENT LIKE CONCAT('%', #{SEARCHTEXT}, '%'))
                </otherwise>
            </choose>
        </if>
    </select>

    <!-- FAQ 상세 조회 -->
    <select id="boardFaqView" parameterType="hashmap" resultType="hashmap">
        SELECT
            A.BOARD_SEQ,
            A.BOARD_MNG_SEQ,
            A.SUBJECT,
            A.CONTENT,
            A.REG_ID,
            A.REG_NM,
            DATE_FORMAT(A.REG_DT, '%Y-%m-%d %H:%i:%s') AS REG_DT,
            A.UPD_ID,
            DATE_FORMAT(A.UPD_DT, '%Y-%m-%d %H:%i:%s') AS UPD_DT,
            A.CATEGORY_CODE,
            (SELECT C.CATEGORY_NM FROM TB_CATEGORY C WHERE C.CATEGORY_CODE = A.CATEGORY_CODE) AS CATEGORY_NM
        FROM TB_BOARD A
        WHERE A.BOARD_SEQ = #{BOARD_SEQ}
          AND A.DEL_YN = 'N'
    </select>

    <!-- FAQ 카테고리 목록 조회 -->
    <select id="getFaqCategoryList" parameterType="hashmap" resultType="hashmap">
        SELECT
            CATEGORY_CODE,
            CATEGORY_NM,
            PARENT_CODE,
            SORT_ORDER
        FROM TB_CATEGORY
        WHERE USE_YN = 'Y'
          AND CATEGORY_TYPE = 'FAQ'
        ORDER BY SORT_ORDER
    </select>

</mapper>
